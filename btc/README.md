# bitcoin-core

This docker image is based on a slim Debian image, points to a specific version branch or release of Bitcoin Core. Uses the pre-compiled binaries which are fully tested by the Bitcoin Core team.

This image contains the main binaries from the Bitcoin Core project - bitcoind, bitcoin-cli and bitcoin-tx. It behaves like a binary, so you can pass any arguments to the image and they will be forwarded to the bitcoind binary.

By default, bitcoind will run as user bitcoin for security reasons and with its default data dir (~/.bitcoin). If you'd like to customize where bitcoin-core stores its data, you must use the BITCOIN_DATA environment variable. The directory will be automatically created with the correct permissions for the bitcoin user and bitcoin-core automatically configured to use it.

## Interact with the daemon

There are two communications methods to interact with a running Bitcoin Core daemon.

The first one is using a cookie-based local authentication. It doesn't require any special authentication information as running a process locally under the same user that was used to launch the Bitcoin Core daemon allows it to read the cookie file previously generated by the daemon for clients. The downside of this method is that it requires local machine access.

The second option is making a remote procedure call using a username and password combination. This has the advantage of not requiring local machine access, but in order to keep your credentials safe you should use the newer rpcauth authentication mechanism.

### Using cookie-based local authentication

```
> docker exec --user bitcoin bitcoin-core bitcoin-cli -regtest getmininginfo
```

In the background, `bitcoin-cli` read the information automatically from `/home/bitcoin/.bitcoin/regtest/.cookie`. In production, the path would not contain the regtest part.

### Using rpcauth for remote authentication

Before setting up remote authentication, you will need to generate the rpcauth line that will hold the credentials for the Bitcoind Core daemon. You can either do this yourself by constructing the line with the format `<user>:<salt>$<hash>` or use the official `rpcauth.py` script to generate this line for you, including a random password that is printed to the console.

```
> curl -sSL https://raw.githubusercontent.com/bitcoin/bitcoin/master/share/rpcauth/rpcauth.py | python - <username>
```

Now that you have your credentials, you need to start the Bitcoin Core daemon with the `-rpcauth` option. Alternatively, you could append the line to a `bitcoin.conf` file and mount it on the container.

```
docker run --rm --name bitcoin-core -it akagi201/bitcoin-core \
  -printtoconsole \
  -regtest=1 \
  -rpcallowip=172.17.0.0/16 \
  -rpcauth='foo:7d9ba5ae63c3d4dc30583ff4fe65a67e$9e3634e81c11659e3de036d0bf88f89cd169c1039e6e09607562d54765c649cc'
```

Two important notes:

  1. Some shells require escaping the rpcauth line (e.g. zsh), as shown above.
  2. It is now perfectly fine to pass the rpcauth line as a command line argument. Unlike -rpcpassword, the content is hashed so even if the arguments would be exposed, they would not allow the attacker to get the actual password.

## Ports

### Mainnet
* JSON-RPC/REST: 8332
* P2P: 8333

### Testnet
* Testnet JSON-RPC: 18332
* P2P: 18333

### Regtest
* JSON-RPC/REST: 18443 (since 0.16+, otherwise 18332)
* P2P: 18444

## Run

### test

```
docker run --name bitcoin-core --restart=unless-stopped -d -p 8332:8332 -p 8333:8333 -v ~/bitcoin:/home/bitcoin/.bitcoin akagi201/bitcoin-core -printtoconsole -regtest=1
```

### testnet

```
docker run --name bitcoin-core --restart=unless-stopped -d -p 18332:18332 -p 18333:18333 -v ~/bitcoin:/home/bitcoin/.bitcoin akagi201/bitcoin-core -printtoconsole -testnet
```

### mainnet

```
docker run --name bitcoin-core --restart=unless-stopped -d -p 8332:8332 -p 8333:8333 -v ~/bitcoin:/home/bitcoin/.bitcoin akagi201/bitcoin-core -printtoconsole -rpcallowip=172.17.0.0/16 -rpcauth='foo:bar'
```